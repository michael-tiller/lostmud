# .cursorrules
# ROT/ROM MUD Legacy Codebase
#
# Description:
#   This project is a derivative of the Diku/ROM/ROT MUD family. It is a legacy
#   C89 codebase with custom allocators, global state, and linked-list based data
#   structures. These rules are designed to constrain AI assistants to *patching*
#   and *maintaining* the existing code, not modernizing or rewriting it.
#
# Common Pitfalls (DO NOT DO THESE):
#   - Do NOT replace `crypt()` with a modern password hash unless explicitly requested.
#   - Do NOT replace `alloc_mem`/`free_mem` with malloc/free.
#   - Do NOT change `%d` → `%ld` blindly; only fix when warnings explicitly demand it.
#   - Do NOT remove global variables (e.g., `help_first`, `note_list`).
#   - Do NOT introduce C99/C11 features (`//` comments, `inline`, `stdbool.h`).
#   - Do NOT rename commands, socials, or gameplay constants.
#   - Do NOT alter file formats for players, areas, or help files.
#   - Do NOT modularize or split files into new libraries.
#   - Do NOT add dependencies outside of the base system headers.
#
# Usage:
#   Place this file at the root of your repository. Cursor/AI agents will then
#   apply these rules when generating or editing code.
#
# Example allowed edit:
#   Fixing a format specifier from `%d` → `%ld` when warnings indicate mismatched types.
# Example disallowed edit:
#   Replacing alloc_mem/free_mem with malloc/free or introducing C++ STL containers.

rules:
  language:
    - Primary language: "C89"
    - Strictly disallow C99/C11 features:
      - No // comments
      - No inline or static inline unless already present
      - No designated initializers
      - No `stdbool.h`
    - Never introduce C++.

  formatting:
    - Indentation: tabs only
    - Maximum line length: 80 characters
    - Opening braces: same line for functions and control structures
    - Pointer style: `type *name`, never `type* name`

  compatibility:
    - Must compile cleanly with GCC on Linux and MSVC on Windows.
    - Preserve system calls like `crypt()`.
    - Do not replace legacy macros (`args`, `IS_NPC`, `UMAX`, etc.).
    - Respect platform-specific behavior (file I/O, sockets, signals).

  memory:
    - Preserve custom memory system (`alloc_mem`, `free_mem`, `alloc_perm`).
    - Do not substitute with malloc/free or modern allocators.
    - Do not alter block sizing or free list mechanics.

  functions:
    - Maintain existing function signatures.
    - Avoid adding new parameters unless required by bug fix.
    - Do not change return types (keep `void`, `int`, etc.).
    - No inline or lambda functions.

  error_handling:
    - Use `bug()`, `perror()`, and existing logging style.
    - Do not add exceptions, assertions, or modern frameworks.

  comments:
    - Only use `/* ... */`.
    - Do not introduce Doxygen or Markdown doc comments.

  agent_behavior:
    - Prefer surgical edits over large refactors.
    - Preserve global variable patterns and linked lists.
    - Do not restructure file layout or modularize into new libraries.
    - Avoid introducing new dependencies.
    - Fix in-place; do not rewrite unrelated code.

  mud_specific:
    - Preserve text save/load format for `.plr` player files.
    - Maintain linked list conventions (`help_first`, `note_list`, etc.).
    - Keep core systems: socials, commands, area files, OLC.
    - Do not rename commands or change gameplay constants.
